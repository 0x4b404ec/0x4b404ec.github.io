<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Unity PlayableDirector正播倒播处理 | 0x4b404ec</title>
<meta name=keywords content="Unity,PlayableDirector,Timeline"><meta name=description content="Unity PlayableDirector(Timeline) 正播倒播处理 项目要求控制Timeline的播放状态，官方给出的方案只有正播的处理，并没有倒播的接口。
而且网上搜索的一些方案都是使用协程，但是协程在处理中途暂停继续播放上比较难处理。
所以自己随便写了一个。处理上比较傻瓜。
下载DoTween插件 略&mldr;
TimelineHelper.cs 主要是提供了两个静态接口，用来实现挂TimelineDirector组件
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using UnityEngine; using UnityEngine.Playables; public static class PlayableExpansion { /// <summary> /// 为director添加自定义控制器 /// </summary> /// <param name=&#34;director&#34;></param> /// <returns></returns> public static PlayableController AddPlayableController(this PlayableDirector director) { return director.gameObject.AddComponent<PlayableController>(); } /// <summary> /// 为obj添加自定义控制器 /// </summary> /// <param name=&#34;obj&#34;></param> /// <returns></returns> public static PlayableController AddPlayableController(this GameObject obj) { return obj."><meta name=author content="0x4b404ec"><link rel=canonical href=https://0x4b404ec.github.io/posts/unityplayabledirector%E6%AD%A3%E6%92%AD%E5%80%92%E6%92%AD%E5%A4%84%E7%90%86/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.2d50b1531bd1b3146d65c5543bd298f7f982786aadee4c223cb3a1cb51906106.css integrity="sha256-LVCxUxvRsxRtZcVUO9KY9/mCeGqt7kwiPLOhy1GQYQY=" rel="preload stylesheet" as=style><link rel=icon href="https://avatars.githubusercontent.com/u/13428164?v=4"><link rel=icon type=image/png sizes=16x16 href="https://avatars.githubusercontent.com/u/13428164?v=4"><link rel=icon type=image/png sizes=32x32 href="https://avatars.githubusercontent.com/u/13428164?v=4"><link rel=apple-touch-icon href="https://avatars.githubusercontent.com/u/13428164?v=4"><link rel=mask-icon href=https://0x4b404ec.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Unity PlayableDirector正播倒播处理"><meta property="og:description" content="Unity PlayableDirector(Timeline) 正播倒播处理 项目要求控制Timeline的播放状态，官方给出的方案只有正播的处理，并没有倒播的接口。
而且网上搜索的一些方案都是使用协程，但是协程在处理中途暂停继续播放上比较难处理。
所以自己随便写了一个。处理上比较傻瓜。
下载DoTween插件 略&mldr;
TimelineHelper.cs 主要是提供了两个静态接口，用来实现挂TimelineDirector组件
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using UnityEngine; using UnityEngine.Playables; public static class PlayableExpansion { /// <summary> /// 为director添加自定义控制器 /// </summary> /// <param name=&#34;director&#34;></param> /// <returns></returns> public static PlayableController AddPlayableController(this PlayableDirector director) { return director.gameObject.AddComponent<PlayableController>(); } /// <summary> /// 为obj添加自定义控制器 /// </summary> /// <param name=&#34;obj&#34;></param> /// <returns></returns> public static PlayableController AddPlayableController(this GameObject obj) { return obj."><meta property="og:type" content="article"><meta property="og:url" content="https://0x4b404ec.github.io/posts/unityplayabledirector%E6%AD%A3%E6%92%AD%E5%80%92%E6%92%AD%E5%A4%84%E7%90%86/"><meta property="og:image" content="https://0x4b404ec.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-31T19:57:41+08:00"><meta property="article:modified_time" content="2023-12-31T19:57:41+08:00"><meta property="og:site_name" content="0x4b404ec"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0x4b404ec.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Unity PlayableDirector正播倒播处理"><meta name=twitter:description content="Unity PlayableDirector(Timeline) 正播倒播处理 项目要求控制Timeline的播放状态，官方给出的方案只有正播的处理，并没有倒播的接口。
而且网上搜索的一些方案都是使用协程，但是协程在处理中途暂停继续播放上比较难处理。
所以自己随便写了一个。处理上比较傻瓜。
下载DoTween插件 略&mldr;
TimelineHelper.cs 主要是提供了两个静态接口，用来实现挂TimelineDirector组件
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using UnityEngine; using UnityEngine.Playables; public static class PlayableExpansion { /// <summary> /// 为director添加自定义控制器 /// </summary> /// <param name=&#34;director&#34;></param> /// <returns></returns> public static PlayableController AddPlayableController(this PlayableDirector director) { return director.gameObject.AddComponent<PlayableController>(); } /// <summary> /// 为obj添加自定义控制器 /// </summary> /// <param name=&#34;obj&#34;></param> /// <returns></returns> public static PlayableController AddPlayableController(this GameObject obj) { return obj."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://0x4b404ec.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Unity PlayableDirector正播倒播处理","item":"https://0x4b404ec.github.io/posts/unityplayabledirector%E6%AD%A3%E6%92%AD%E5%80%92%E6%92%AD%E5%A4%84%E7%90%86/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Unity PlayableDirector正播倒播处理","name":"Unity PlayableDirector正播倒播处理","description":"Unity PlayableDirector(Timeline) 正播倒播处理 项目要求控制Timeline的播放状态，官方给出的方案只有正播的处理，并没有倒播的接口。\n而且网上搜索的一些方案都是使用协程，但是协程在处理中途暂停继续播放上比较难处理。\n所以自己随便写了一个。处理上比较傻瓜。\n下载DoTween插件 略\u0026hellip;\nTimelineHelper.cs 主要是提供了两个静态接口，用来实现挂TimelineDirector组件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using UnityEngine; using UnityEngine.Playables; public static class PlayableExpansion { /// \u0026lt;summary\u0026gt; /// 为director添加自定义控制器 /// \u0026lt;/summary\u0026gt; /// \u0026lt;param name=\u0026#34;director\u0026#34;\u0026gt;\u0026lt;/param\u0026gt; /// \u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt; public static PlayableController AddPlayableController(this PlayableDirector director) { return director.gameObject.AddComponent\u0026lt;PlayableController\u0026gt;(); } /// \u0026lt;summary\u0026gt; /// 为obj添加自定义控制器 /// \u0026lt;/summary\u0026gt; /// \u0026lt;param name=\u0026#34;obj\u0026#34;\u0026gt;\u0026lt;/param\u0026gt; /// \u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt; public static PlayableController AddPlayableController(this GameObject obj) { return obj.","keywords":["Unity","PlayableDirector","Timeline"],"articleBody":"Unity PlayableDirector(Timeline) 正播倒播处理 项目要求控制Timeline的播放状态，官方给出的方案只有正播的处理，并没有倒播的接口。\n而且网上搜索的一些方案都是使用协程，但是协程在处理中途暂停继续播放上比较难处理。\n所以自己随便写了一个。处理上比较傻瓜。\n下载DoTween插件 略…\nTimelineHelper.cs 主要是提供了两个静态接口，用来实现挂TimelineDirector组件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using UnityEngine; using UnityEngine.Playables; public static class PlayableExpansion { /// /// 为director添加自定义控制器 /// /// /// public static PlayableController AddPlayableController(this PlayableDirector director) { return director.gameObject.AddComponent\u003cPlayableController\u003e(); } /// /// 为obj添加自定义控制器 /// /// /// public static PlayableController AddPlayableController(this GameObject obj) { return obj.AddComponent\u003cPlayableController\u003e(); } } TimelineDirector.cs Timeline的相关控制封装，没有用官方播放的API，只用到了PlayableDirector时间和采样(PlayableDirector.time和PlayableDirector.Evaluate())\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 using DG.Tweening; using Sirenix.OdinInspector; using System; using UnityEngine; using UnityEngine.Playables; [RequireComponent(typeof(PlayableDirector))] public class PlayableController : MonoBehaviour { #region ENUM public enum Status { NULL, PLAYING, PAUSED, STOPPED, } public enum Direction { NULL, FORWARD, BACKWARD } #endregion [SerializeField] private PlayableDirector m_playableDirector; /// /// 当前播放状态(如果用不到可是删除，现在这个字段只是一个状态的记录) /// public Status CurrentPlayStatus { get; private set; } = Status.NULL; /// /// 当前播放方向(如果用不到可是删除，现在这个字段只是一个状态的记录) /// public Direction CurrentPlayDirection { get; private set; } = Direction.NULL; /// /// 当前播放进度 /// public double FullProgress { get; private set; } = 0d; /// /// 片段进度 /// //public double ClipProgress { get; private set; } = 0d; /// /// 当前播放进度归一化 /// public double CurrentNormalizedProgress =\u003e FullProgress / Duration; [Range(0f, 5f)] public float PlaySpeed = 1f; /// /// 播放模式 /// public WrapMode WrapMode = WrapMode.Once; /// /// 开始播放事件, 返回时 时间点，和触发时方向 /// public Action\u003cdouble, Direction\u003e OnPlay; /// /// 暂停播放事件, 返回时 时间点，和触发时方向 /// public Action\u003cdouble, Direction\u003e OnPause; /// /// 停止播放事件, 返回时 时间点，和触发时方向 /// public Action\u003cdouble, Direction\u003e OnStop; /// /// 继续播放事件, 返回时 时间点，和触发时方向 /// public Action\u003cdouble, Direction\u003e OnContinue; /// /// 当播放自动停止，既本次的ProgressExecute播放到指定事件点时触发； /// public Action\u003cdouble\u003e OnAutoStop; public Action\u003cdouble\u003e OnUpdate; /// /// Timeline长度 /// public double Duration { get; private set; } = -1f; private Tweener m_timeTween; public bool TweenActive =\u003e m_timeTween.IsActive(); private void Awake() { m_playableDirector = GetComponent\u003cPlayableDirector\u003e(); m_playableDirector.playOnAwake = false; Duration = m_playableDirector.duration; CurrentPlayStatus = Status.STOPPED; } /// /// 继续播放 /// [Button] public void Continue() { if (m_timeTween.IsActive()) { CurrentPlayStatus = Status.PLAYING; m_timeTween.Play(); } OnContinue?.Invoke(FullProgress, CurrentPlayDirection); } /// /// 从暂停时间点正向播放, 应用在倒播中途暂停后切换为正播 /// [Button] public void ContinuePlayForwardByPausePoint() { CurrentPlayStatus = Status.PLAYING; CurrentPlayDirection = Direction.FORWARD; m_timeTween.Kill(); ProgressExecute(Duration); OnContinue?.Invoke(FullProgress, CurrentPlayDirection); } /// /// 从暂停时间点反向播放, 应用在正播中途暂停后切换为倒播 /// [Button] public void ContinuePlayBackwardByPausePoint() { CurrentPlayStatus = Status.PLAYING; CurrentPlayDirection = Direction.BACKWARD; m_timeTween.Kill(); ProgressExecute(0); OnContinue?.Invoke(FullProgress, CurrentPlayDirection); } public void PlayClip(double start, double stop) { if (start == stop) return; CurrentPlayStatus = Status.PLAYING; CurrentPlayDirection = start \u003c stop ? Direction.FORWARD : Direction.BACKWARD; m_timeTween.Kill(); FullProgress = start; ProgressExecute(stop); OnPlay?.Invoke(start, CurrentPlayDirection); } /// /// 从开始播放 /// [Button] public void PlayForward() { CurrentPlayStatus = Status.PLAYING; CurrentPlayDirection = Direction.FORWARD; m_timeTween.Kill(); FullProgress = 0d; ProgressExecute(Duration); OnPlay?.Invoke(FullProgress, CurrentPlayDirection); } /// /// 从结尾倒放 /// [Button] public void PlayBackward() { CurrentPlayStatus = Status.PLAYING; CurrentPlayDirection = Direction.BACKWARD; m_timeTween.Kill(); FullProgress = Duration; ProgressExecute(0); OnPlay?.Invoke(FullProgress, CurrentPlayDirection); } /// /// 暂停播放 /// [Button] public void Pause() { CurrentPlayStatus = Status.PAUSED; m_timeTween.Pause(); OnPause?.Invoke(FullProgress, CurrentPlayDirection); } /// /// 停止播放 /// [Button] public void Stop() { CurrentPlayStatus = Status.STOPPED; m_timeTween.Kill(); FullProgress = 0d; m_playableDirector.time = FullProgress; m_playableDirector.Evaluate(); OnStop?.Invoke(FullProgress, CurrentPlayDirection); } [Button] public void JumpTo(double progress) { // 直接取样 m_playableDirector.time = progress; m_playableDirector.Evaluate(); FullProgress = progress; OnUpdate?.Invoke(progress); } [Button] public void ForceKill() { m_timeTween.Kill(); CurrentPlayStatus = Status.PAUSED; } private void ProgressExecute(double targetProgress) { // 使用DoTween最当前时间进行线性过渡 m_timeTween = DOTween.To(() =\u003e FullProgress, x =\u003e FullProgress = x, targetProgress, PlaySpeed).SetSpeedBased() .SetEase(Ease.Linear); // 做出限制避免bug FullProgress = Clamp(FullProgress, 0d, Duration); m_timeTween.OnUpdate(() =\u003e { JumpTo(FullProgress); }); m_timeTween.OnComplete(() =\u003e { CurrentPlayStatus = FullProgress == Duration ? Status.STOPPED : Status.PAUSED; OnAutoStop?.Invoke(FullProgress); }); m_timeTween.Play(); } /// /// 针对Double的Clamp /// private static double Clamp(double value, double min, double max) { if (value \u003c min) value = min; else if (value \u003e max) value = max; return value; } } TimelineTestController 测试类创建一个场景自己制作一个Timeline, 绑定一些按钮。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 using System.Collections; using System.Collections.Generic; using Tools; using UnityEngine; using UnityEngine.Playables; using UnityEngine.UI; public class TimelineTestController : MonoBehaviour { public PlayableDirector PlayableDirector; public Button PlayForward; public Button PlayBackward; public Button Pause; public Button Stop; public Button Continue; public Button ContinueForward; public Button ContinueBackward; public TimelineDirector Director; public void Start() { Director = TimelineHelper.CreateTimelineDirector(PlayableDirector); Director.OnPlay = (t, d) =\u003e { Debug.Log($\"OnPlay time {t} dir {d}\"); }; Director.OnPause = (t, d) =\u003e { Debug.Log($\"OnPause time {t} dir {d}\"); }; Director.OnContinue = (t, d) =\u003e { Debug.Log($\"OnContinue time {t} dir {d}\"); }; Director.OnStop = (t, d) =\u003e { Debug.Log($\"OnStop time {t} dir {d}\"); }; PlayForward.onClick.AddListener(() =\u003e { Director.PlayForward(); }); PlayBackward.onClick.AddListener(() =\u003e { Director.PlayBackward(); }); Pause.onClick.AddListener(() =\u003e { Director.Pause(); }); Stop.onClick.AddListener(() =\u003e { Director.Stop(); }); Continue.onClick.AddListener(() =\u003e { Director.Continue(); }); ContinueForward.onClick.AddListener(() =\u003e { Director.ContinuePlayForwardByPausePoint(); }); ContinueBackward.onClick.AddListener(() =\u003e { Director.ContinuePlayBackwardByPausePoint(); }); } } ","wordCount":"1131","inLanguage":"en","datePublished":"2023-12-31T19:57:41+08:00","dateModified":"2023-12-31T19:57:41+08:00","author":{"@type":"Person","name":"0x4b404ec"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://0x4b404ec.github.io/posts/unityplayabledirector%E6%AD%A3%E6%92%AD%E5%80%92%E6%92%AD%E5%A4%84%E7%90%86/"},"publisher":{"@type":"Organization","name":"0x4b404ec","logo":{"@type":"ImageObject","url":"https://avatars.githubusercontent.com/u/13428164?v=4"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://0x4b404ec.github.io/ accesskey=h title="0x4b404ec's Blog (Alt + H)"><img src="https://avatars.githubusercontent.com/u/13428164?v=4" alt aria-label=logo height=35>0x4b404ec's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://0x4b404ec.github.io/about title=Me><span>Me</span></a></li><li><a href=https://0x4b404ec.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://0x4b404ec.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://0x4b404ec.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/adityatelange/hugo-PaperMod/wiki title=Theme.org><span>Theme.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://0x4b404ec.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://0x4b404ec.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Unity PlayableDirector正播倒播处理</h1><div class=post-meta><span title='2023-12-31 19:57:41 +0800 CST'>2023-12-31</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1131 words&nbsp;·&nbsp;0x4b404ec</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#下载dotween插件>下载DoTween插件</a></li><li><a href=#timelinehelpercs>TimelineHelper.cs</a></li><li><a href=#timelinedirectorcs>TimelineDirector.cs</a></li><li><a href=#timelinetestcontroller>TimelineTestController</a></li></ul></nav></div></details></div><div class=post-content><h1 id=unity-playabledirectortimeline-正播倒播处理>Unity PlayableDirector(Timeline) 正播倒播处理<a hidden class=anchor aria-hidden=true href=#unity-playabledirectortimeline-正播倒播处理>#</a></h1><blockquote><p>项目要求控制Timeline的播放状态，官方给出的方案只有正播的处理，并没有倒播的接口。</p><p>而且网上搜索的一些方案都是使用<a href="https://so.csdn.net/so/search?q=%E5%8D%8F%E7%A8%8B&amp;spm=1001.2101.3001.7020">协程</a>，但是协程在处理中途暂停继续播放上比较难处理。</p><p>所以自己随便写了一个。处理上比较傻瓜。</p></blockquote><h2 id=下载dotween插件>下载DoTween插件<a hidden class=anchor aria-hidden=true href=#下载dotween插件>#</a></h2><p>略&mldr;</p><h2 id=timelinehelpercs>TimelineHelper.cs<a hidden class=anchor aria-hidden=true href=#timelinehelpercs>#</a></h2><p>主要是提供了两个静态接口，用来实现挂TimelineDirector组件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine.Playables</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>class</span> <span class=nc>PlayableExpansion</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 为director添加自定义控制器</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;director&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>PlayableController</span> <span class=n>AddPlayableController</span><span class=p>(</span><span class=k>this</span> <span class=n>PlayableDirector</span> <span class=n>director</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>director</span><span class=p>.</span><span class=n>gameObject</span><span class=p>.</span><span class=n>AddComponent</span><span class=p>&lt;</span><span class=n>PlayableController</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 为obj添加自定义控制器</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;obj&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>PlayableController</span> <span class=n>AddPlayableController</span><span class=p>(</span><span class=k>this</span> <span class=n>GameObject</span> <span class=n>obj</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>obj</span><span class=p>.</span><span class=n>AddComponent</span><span class=p>&lt;</span><span class=n>PlayableController</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>	
</span></span></code></pre></td></tr></table></div></div><h2 id=timelinedirectorcs>TimelineDirector.cs<a hidden class=anchor aria-hidden=true href=#timelinedirectorcs>#</a></h2><p>Timeline的相关控制封装，没有用官方播放的API，只用到了PlayableDirector时间和采样(PlayableDirector.time和PlayableDirector.Evaluate())</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=k>using</span> <span class=nn>DG.Tweening</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Sirenix.OdinInspector</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine.Playables</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>[RequireComponent(typeof(PlayableDirector))]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>PlayableController</span> <span class=p>:</span> <span class=n>MonoBehaviour</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cp>#region</span> <span class=n>ENUM</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>enum</span> <span class=n>Status</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NULL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>PLAYING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>PAUSED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>STOPPED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>enum</span> <span class=n>Direction</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NULL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>FORWARD</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>BACKWARD</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cp>#endregion</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [SerializeField]</span> <span class=kd>private</span> <span class=n>PlayableDirector</span> <span class=n>m_playableDirector</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 当前播放状态(如果用不到可是删除，现在这个字段只是一个状态的记录)</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Status</span> <span class=n>CurrentPlayStatus</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>private</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 当前播放方向(如果用不到可是删除，现在这个字段只是一个状态的记录)</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Direction</span> <span class=n>CurrentPlayDirection</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>private</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=n>Direction</span><span class=p>.</span><span class=n>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 当前播放进度</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double</span> <span class=n>FullProgress</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>private</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=m>0d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 片段进度</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//public double ClipProgress { get; private set; } = 0d;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 当前播放进度归一化</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double</span> <span class=n>CurrentNormalizedProgress</span> <span class=p>=&gt;</span> <span class=n>FullProgress</span> <span class=p>/</span> <span class=n>Duration</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=na>    [Range(0f, 5f)]</span> <span class=kd>public</span> <span class=kt>float</span> <span class=n>PlaySpeed</span> <span class=p>=</span> <span class=m>1f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 播放模式</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>WrapMode</span> <span class=n>WrapMode</span> <span class=p>=</span> <span class=n>WrapMode</span><span class=p>.</span><span class=n>Once</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 开始播放事件, 返回时 时间点，和触发时方向</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Action</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>Direction</span><span class=p>&gt;</span> <span class=n>OnPlay</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 暂停播放事件, 返回时 时间点，和触发时方向</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Action</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>Direction</span><span class=p>&gt;</span> <span class=n>OnPause</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 停止播放事件, 返回时 时间点，和触发时方向</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Action</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>Direction</span><span class=p>&gt;</span> <span class=n>OnStop</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 继续播放事件, 返回时 时间点，和触发时方向</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Action</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>Direction</span><span class=p>&gt;</span> <span class=n>OnContinue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 当播放自动停止，既本次的ProgressExecute播放到指定事件点时触发；</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Action</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>&gt;</span> <span class=n>OnAutoStop</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Action</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>&gt;</span> <span class=n>OnUpdate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Timeline长度</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double</span> <span class=n>Duration</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>private</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span> <span class=p>=</span> <span class=p>-</span><span class=m>1f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Tweener</span> <span class=n>m_timeTween</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>bool</span> <span class=n>TweenActive</span> <span class=p>=&gt;</span> <span class=n>m_timeTween</span><span class=p>.</span><span class=n>IsActive</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>Awake</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m_playableDirector</span> <span class=p>=</span> <span class=n>GetComponent</span><span class=p>&lt;</span><span class=n>PlayableDirector</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>m_playableDirector</span><span class=p>.</span><span class=n>playOnAwake</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Duration</span> <span class=p>=</span> <span class=n>m_playableDirector</span><span class=p>.</span><span class=n>duration</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>STOPPED</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 继续播放</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Continue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>m_timeTween</span><span class=p>.</span><span class=n>IsActive</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PLAYING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Play</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>OnContinue</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 从暂停时间点正向播放, 应用在倒播中途暂停后切换为正播</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ContinuePlayForwardByPausePoint</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PLAYING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayDirection</span> <span class=p>=</span> <span class=n>Direction</span><span class=p>.</span><span class=n>FORWARD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>ProgressExecute</span><span class=p>(</span><span class=n>Duration</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnContinue</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 从暂停时间点反向播放, 应用在正播中途暂停后切换为倒播</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ContinuePlayBackwardByPausePoint</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PLAYING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayDirection</span> <span class=p>=</span> <span class=n>Direction</span><span class=p>.</span><span class=n>BACKWARD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>ProgressExecute</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnContinue</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>PlayClip</span><span class=p>(</span><span class=kt>double</span> <span class=n>start</span><span class=p>,</span> <span class=kt>double</span> <span class=n>stop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>start</span> <span class=p>==</span> <span class=n>stop</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PLAYING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayDirection</span> <span class=p>=</span> <span class=n>start</span> <span class=p>&lt;</span> <span class=n>stop</span> <span class=p>?</span> <span class=n>Direction</span><span class=p>.</span><span class=n>FORWARD</span> <span class=p>:</span> <span class=n>Direction</span><span class=p>.</span><span class=n>BACKWARD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FullProgress</span> <span class=p>=</span> <span class=n>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ProgressExecute</span><span class=p>(</span><span class=n>stop</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnPlay</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 从开始播放</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>PlayForward</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PLAYING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayDirection</span> <span class=p>=</span> <span class=n>Direction</span><span class=p>.</span><span class=n>FORWARD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FullProgress</span> <span class=p>=</span> <span class=m>0d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ProgressExecute</span><span class=p>(</span><span class=n>Duration</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnPlay</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 从结尾倒放</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>PlayBackward</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PLAYING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayDirection</span> <span class=p>=</span> <span class=n>Direction</span><span class=p>.</span><span class=n>BACKWARD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FullProgress</span> <span class=p>=</span> <span class=n>Duration</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ProgressExecute</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnPlay</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 暂停播放</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PAUSED</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Pause</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnPause</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 停止播放</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>STOPPED</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FullProgress</span> <span class=p>=</span> <span class=m>0d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>m_playableDirector</span><span class=p>.</span><span class=n>time</span> <span class=p>=</span> <span class=n>FullProgress</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>m_playableDirector</span><span class=p>.</span><span class=n>Evaluate</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnStop</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=n>CurrentPlayDirection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>JumpTo</span><span class=p>(</span><span class=kt>double</span> <span class=n>progress</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 直接取样</span>
</span></span><span class=line><span class=cl>        <span class=n>m_playableDirector</span><span class=p>.</span><span class=n>time</span> <span class=p>=</span> <span class=n>progress</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>m_playableDirector</span><span class=p>.</span><span class=n>Evaluate</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FullProgress</span> <span class=p>=</span> <span class=n>progress</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>OnUpdate</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>progress</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [Button]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ForceKill</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Kill</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>Status</span><span class=p>.</span><span class=n>PAUSED</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>ProgressExecute</span><span class=p>(</span><span class=kt>double</span> <span class=n>targetProgress</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 使用DoTween最当前时间进行线性过渡</span>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span> <span class=p>=</span> <span class=n>DOTween</span><span class=p>.</span><span class=n>To</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=n>FullProgress</span><span class=p>,</span> <span class=n>x</span> <span class=p>=&gt;</span> <span class=n>FullProgress</span> <span class=p>=</span> <span class=n>x</span><span class=p>,</span> <span class=n>targetProgress</span><span class=p>,</span> <span class=n>PlaySpeed</span><span class=p>).</span><span class=n>SetSpeedBased</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetEase</span><span class=p>(</span><span class=n>Ease</span><span class=p>.</span><span class=n>Linear</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 做出限制避免bug</span>
</span></span><span class=line><span class=cl>        <span class=n>FullProgress</span> <span class=p>=</span> <span class=n>Clamp</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>,</span> <span class=m>0d</span><span class=p>,</span> <span class=n>Duration</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>OnUpdate</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=n>JumpTo</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>);</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>OnComplete</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CurrentPlayStatus</span> <span class=p>=</span> <span class=n>FullProgress</span> <span class=p>==</span> <span class=n>Duration</span> <span class=p>?</span> <span class=n>Status</span><span class=p>.</span><span class=n>STOPPED</span> <span class=p>:</span> <span class=n>Status</span><span class=p>.</span><span class=n>PAUSED</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>OnAutoStop</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>FullProgress</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=n>m_timeTween</span><span class=p>.</span><span class=n>Play</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// 针对Double的Clamp</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>double</span> <span class=n>Clamp</span><span class=p>(</span><span class=kt>double</span> <span class=k>value</span><span class=p>,</span> <span class=kt>double</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>value</span> <span class=p>&lt;</span> <span class=n>min</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>value</span> <span class=p>=</span> <span class=n>min</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>value</span> <span class=p>&gt;</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>value</span> <span class=p>=</span> <span class=n>max</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=timelinetestcontroller>TimelineTestController<a hidden class=anchor aria-hidden=true href=#timelinetestcontroller>#</a></h2><p>测试类创建一个场景自己制作一个Timeline, 绑定一些按钮。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Tools</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine.Playables</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>UnityEngine.UI</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>TimelineTestController</span> <span class=p>:</span> <span class=n>MonoBehaviour</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PlayableDirector</span> <span class=n>PlayableDirector</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Button</span> <span class=n>PlayForward</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Button</span> <span class=n>PlayBackward</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Button</span> <span class=n>Pause</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Button</span> <span class=n>Stop</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Button</span> <span class=n>Continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Button</span> <span class=n>ContinueForward</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Button</span> <span class=n>ContinueBackward</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>TimelineDirector</span> <span class=n>Director</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Director</span> <span class=p>=</span> <span class=n>TimelineHelper</span><span class=p>.</span><span class=n>CreateTimelineDirector</span><span class=p>(</span><span class=n>PlayableDirector</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>Director</span><span class=p>.</span><span class=n>OnPlay</span> <span class=p>=</span> <span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>$&#34;OnPlay time {t} dir {d}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>Director</span><span class=p>.</span><span class=n>OnPause</span> <span class=p>=</span> <span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>$&#34;OnPause time {t} dir {d}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>Director</span><span class=p>.</span><span class=n>OnContinue</span> <span class=p>=</span> <span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>$&#34;OnContinue time {t} dir {d}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>Director</span><span class=p>.</span><span class=n>OnStop</span> <span class=p>=</span> <span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>$&#34;OnStop time {t} dir {d}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>PlayForward</span><span class=p>.</span><span class=n>onClick</span><span class=p>.</span><span class=n>AddListener</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Director</span><span class=p>.</span><span class=n>PlayForward</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>PlayBackward</span><span class=p>.</span><span class=n>onClick</span><span class=p>.</span><span class=n>AddListener</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Director</span><span class=p>.</span><span class=n>PlayBackward</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>Pause</span><span class=p>.</span><span class=n>onClick</span><span class=p>.</span><span class=n>AddListener</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Director</span><span class=p>.</span><span class=n>Pause</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>Stop</span><span class=p>.</span><span class=n>onClick</span><span class=p>.</span><span class=n>AddListener</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Director</span><span class=p>.</span><span class=n>Stop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>Continue</span><span class=p>.</span><span class=n>onClick</span><span class=p>.</span><span class=n>AddListener</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Director</span><span class=p>.</span><span class=n>Continue</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>ContinueForward</span><span class=p>.</span><span class=n>onClick</span><span class=p>.</span><span class=n>AddListener</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Director</span><span class=p>.</span><span class=n>ContinuePlayForwardByPausePoint</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>ContinueBackward</span><span class=p>.</span><span class=n>onClick</span><span class=p>.</span><span class=n>AddListener</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Director</span><span class=p>.</span><span class=n>ContinuePlayBackwardByPausePoint</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://0x4b404ec.github.io/tags/unity/>Unity</a></li><li><a href=https://0x4b404ec.github.io/tags/playabledirector/>PlayableDirector</a></li><li><a href=https://0x4b404ec.github.io/tags/timeline/>Timeline</a></li></ul><nav class=paginav><a class=prev href=https://0x4b404ec.github.io/posts/hugo+githubaction%E6%90%AD%E5%BB%BApages-%E8%BD%AC/><span class=title>« Prev</span><br><span>[转] Hugo+GithubAction搭建Pages</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://0x4b404ec.github.io/>0x4b404ec</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>